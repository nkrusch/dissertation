name: Test

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

on:
  schedule:
    - cron:  '0 0 1 * *'
  workflow_dispatch:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  exec_test:
    name: Runtime test
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      - name: ðŸŸ  Command test in Docker
        uses: addnab/docker-run-action@v3
        with:
          registry: gcr.io
          image: ghcr.io/nkrusch/dissertation:artifact
          options: --platform=linux/amd64 --rm --user root
          shell: bash
          run: |
              bash -c "source /root/.bashrc"
              pymwp --version ; dafny --version ; coqc --version 
              pymwp --info examples/original_paper/example3_1_b.c 
              (cd code && coqc equiv.v && dafny verify equiv.dfy)
